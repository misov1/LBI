<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LBI â†’ CPM ì„¤ì • ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; padding: 24px; }
  h1 { font-size: 1.6rem; margin-bottom: 8px; color: #58a6ff; }
  .subtitle { color: #8b949e; margin-bottom: 24px; font-size: 0.9rem; }
  .container { max-width: 960px; margin: 0 auto; }
  .card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
  .card h2 { font-size: 1.1rem; margin-bottom: 12px; color: #f0f6fc; }
  .card h3 { font-size: 0.95rem; margin: 12px 0 8px; color: #58a6ff; }
  label { display: block; font-size: 0.85rem; color: #8b949e; margin-bottom: 6px; }
  textarea { width: 100%; min-height: 160px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; padding: 12px; font-family: 'Cascadia Code', 'Fira Code', monospace; font-size: 0.82rem; resize: vertical; }
  textarea:focus { outline: none; border-color: #58a6ff; }
  .btn { display: inline-block; padding: 8px 20px; border: 1px solid #30363d; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.15s; margin-right: 8px; margin-top: 8px; }
  .btn-primary { background: #238636; border-color: #2ea043; color: #fff; }
  .btn-primary:hover { background: #2ea043; }
  .btn-secondary { background: #21262d; color: #c9d1d9; }
  .btn-secondary:hover { background: #30363d; }
  .btn-danger { background: #da3633; border-color: #f85149; color: #fff; }
  .btn-danger:hover { background: #f85149; }
  .output-area { min-height: 200px; }
  .log { margin-top: 12px; padding: 12px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; font-family: monospace; font-size: 0.8rem; max-height: 300px; overflow-y: auto; white-space: pre-wrap; word-break: break-all; }
  .log .info { color: #58a6ff; }
  .log .success { color: #3fb950; }
  .log .warn { color: #d29922; }
  .log .error { color: #f85149; }
  .log .skip { color: #8b949e; }
  .stats { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 12px; }
  .stat-box { background: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 10px 16px; min-width: 120px; text-align: center; }
  .stat-box .num { font-size: 1.4rem; font-weight: 700; color: #58a6ff; }
  .stat-box .lbl { font-size: 0.75rem; color: #8b949e; }
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  @media (max-width: 640px) { .two-col { grid-template-columns: 1fr; } }
  .file-input-wrapper { position: relative; display: inline-block; }
  .file-input-wrapper input[type="file"] { position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
  .mapping-table { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 0.8rem; }
  .mapping-table th, .mapping-table td { padding: 6px 10px; border: 1px solid #30363d; text-align: left; }
  .mapping-table th { background: #21262d; color: #f0f6fc; font-weight: 600; }
  .mapping-table td { color: #c9d1d9; }
  .mapping-table td.arrow { text-align: center; color: #58a6ff; font-weight: bold; }
  details { margin-top: 12px; }
  details summary { cursor: pointer; color: #58a6ff; font-size: 0.85rem; font-weight: 600; }
  details summary:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ§ LBI â†’ Cupcake PM ì„¤ì • ë§ˆì´ê·¸ë ˆì´ì…˜</h1>
  <p class="subtitle">LBI í”ŒëŸ¬ê·¸ì¸ ì„¤ì •ì„ Cupcake Provider Manager (CPM) í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.<br>
    Google(Gemini), Vertex AI, Anthropic, AWS Bedrock, DeepSeek, OpenAI, Custom Provider ì„¤ì •ì´ í¬í•¨ë©ë‹ˆë‹¤.</p>

  <!-- ì…ë ¥ -->
  <div class="card">
    <h2>â‘  LBI ì„¤ì • ì…ë ¥</h2>
    <p style="color:#8b949e; font-size:0.82rem; margin-bottom:12px;">
      LBI í”ŒëŸ¬ê·¸ì¸ì—ì„œ ë‚´ë³´ë‚¸ JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜, í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.<br>
      ì§€ì› í˜•ì‹: <code>{ "lbiSettings": { ... } }</code> ë˜ëŠ” <code>{ "common_googleAIProvider_apiKey": "...", ... }</code>
    </p>
    <div style="margin-bottom: 12px;">
      <div class="file-input-wrapper">
        <button class="btn btn-secondary">ğŸ“‚ JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="fileInput" accept=".json">
      </div>
    </div>
    <label for="inputJson">LBI ì„¤ì • JSON:</label>
    <textarea id="inputJson" placeholder='{ "lbiSettings": { "common_googleAIProvider_apiKey": "AIza...", ... } }'></textarea>
  </div>

  <!-- ë³€í™˜ -->
  <div class="card">
    <h2>â‘¡ ë³€í™˜</h2>
    <button class="btn btn-primary" onclick="doConvert()">ğŸ”„ ë³€í™˜ ì‹¤í–‰</button>
    <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ ì´ˆê¸°í™”</button>
    <div id="logArea" class="log" style="display:none;"></div>
    <div id="statsArea" class="stats" style="display:none;"></div>
  </div>

  <!-- ì¶œë ¥ -->
  <div class="card">
    <h2>â‘¢ CPM ì„¤ì • ì¶œë ¥</h2>
    <p style="color:#8b949e; font-size:0.82rem; margin-bottom:12px;">
      ë³€í™˜ëœ CPM ì„¤ì •ì„ ë³µì‚¬í•˜ê±°ë‚˜ JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.<br>
      CPM ì„¤ì •ì—ì„œ <b>ê°€ì ¸ì˜¤ê¸°(Import)</b> ê¸°ëŠ¥ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>
    <div style="background:#1a1e24; border:1px solid #d29922; border-radius:6px; padding:12px; margin-bottom:12px;">
      <p style="color:#d29922; font-size:0.82rem; margin:0; line-height:1.5;">
        âš ï¸ <b>Import í›„ ì£¼ì˜ì‚¬í•­:</b><br>
        1. CPMì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°(Import) ì‹¤í–‰ í›„, <b>ì„¤ì • íŒ¨ë„ì„ ë‹«ê³  ë‹¤ì‹œ ì—´ì–´ì•¼</b> ëª¨ë“  íƒ­ì— ë°˜ì˜ë©ë‹ˆë‹¤.<br>
        2. ì»¤ìŠ¤í…€ ëª¨ë¸ì˜ ê²½ìš°, <b>í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨(F5)</b> í›„ ì •ìƒ ë°˜ì˜ë©ë‹ˆë‹¤.<br>
        <span style="color:#8b949e;">(CPM v1.14.7 ê¸°ì¤€ â€” í–¥í›„ ë²„ì „ì—ì„œ ìë™ ë¦¬í”„ë ˆì‹œê°€ ì¶”ê°€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)</span>
      </p>
    </div>
    <label for="outputJson">CPM ì„¤ì • JSON:</label>
    <textarea id="outputJson" class="output-area" readonly placeholder="ë³€í™˜ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
    <div>
      <button class="btn btn-secondary" onclick="copyOutput()">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
      <button class="btn btn-secondary" onclick="downloadOutput()">ğŸ’¾ JSON ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </div>

  <!-- ë§¤í•‘ ì°¸ì¡° -->
  <div class="card">
    <details>
      <summary>ğŸ“– ì„¤ì • í‚¤ ë§¤í•‘ ì°¸ì¡° í…Œì´ë¸”</summary>
      <h3>í”„ë¡œë°”ì´ë” API í‚¤/ì„¤ì •</h3>
      <table class="mapping-table">
        <thead><tr><th>LBI í‚¤</th><th></th><th>CPM í‚¤</th><th>ì„¤ëª…</th></tr></thead>
        <tbody>
          <tr><td>common_googleAIProvider_apiKey</td><td class="arrow">â†’</td><td>cpm_gemini_key</td><td>Google AI Studio API í‚¤</td></tr>
          <tr><td>chat_gemini_thinkingLevel</td><td class="arrow">â†’</td><td>cpm_gemini_thinking_level</td><td>Gemini 3 ì‚¬ê³  ìˆ˜ì¤€</td></tr>
          <tr><td>chat_sampling_thinkingTokens</td><td class="arrow">â†’</td><td>cpm_gemini_thinking_budget</td><td>Gemini 2.5 ì‚¬ê³  ì˜ˆì‚°</td></tr>
          <tr><td>chat_gemini_preserveSystem</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë³´ì¡´</td></tr>
          <tr><td>chat_gemini_showThoughtsToken</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>ìƒê° í† í° í‘œì‹œ</td></tr>
          <tr><td>chat_gemini_useThoughtSignature</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>ìƒê° ì„œëª… ì‚¬ìš©</td></tr>
          <tr><td>chat_gemini_usePlainFetch</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>ì§ì ‘ ìš”ì²­</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>common_vertexAIProvider_credentials</td><td class="arrow">â†’</td><td>cpm_vertex_key_json</td><td>Vertex AI JSON í‚¤</td></tr>
          <tr><td>common_vertexAIProvider_projectId<br>+ privateKey + clientEmail</td><td class="arrow">â†’</td><td>cpm_vertex_key_json</td><td>ê°œë³„ í•„ë“œ â†’ JSON í•©ì„±</td></tr>
          <tr><td>common_vertexAIProvider_customLocation</td><td class="arrow">â†’</td><td>cpm_vertex_location</td><td>Vertex ë¦¬ì „</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>common_anthropicProvider_apiKey</td><td class="arrow">â†’</td><td>cpm_anthropic_key</td><td>Anthropic API í‚¤</td></tr>
          <tr><td>chat_claude_caching</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>í´ë¡œë“œ ìºì‹±</td></tr>
          <tr><td>chat_claude_effort</td><td class="arrow">â†’</td><td>cpm_anthropic_thinking_effort</td><td>í´ë¡œë“œ ë…¸ë ¥ ìˆ˜ì¤€</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>common_awsProvider_accessKey</td><td class="arrow">â†’</td><td>cpm_aws_key</td><td>AWS ì•¡ì„¸ìŠ¤ í‚¤</td></tr>
          <tr><td>common_awsProvider_secretAccessKey</td><td class="arrow">â†’</td><td>cpm_aws_secret</td><td>AWS ì‹œí¬ë¦¿ í‚¤</td></tr>
          <tr><td>common_awsProvider_region</td><td class="arrow">â†’</td><td>cpm_aws_region</td><td>AWS ë¦¬ì „</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>common_deepseekProvider_apiKey</td><td class="arrow">â†’</td><td>cpm_deepseek_key</td><td>DeepSeek API í‚¤</td></tr>
          <tr><td>common_deepseekProvider_customUrl</td><td class="arrow">â†’</td><td>cpm_deepseek_url</td><td>DeepSeek ì»¤ìŠ¤í…€ URL</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>common_openaiProvider_apiKey</td><td class="arrow">â†’</td><td>cpm_openai_key</td><td>OpenAI API í‚¤</td></tr>
          <tr><td>common_openaiProvider_reasoningEffort</td><td class="arrow">â†’</td><td>cpm_openai_reasoning</td><td>ì¶”ë¡  ê°•ë„</td></tr>
          <tr><td>common_openaiProvider_verbosity</td><td class="arrow">â†’</td><td>cpm_openai_verbosity</td><td>ì‘ë‹µ ìƒì„¸</td></tr>
          <tr><td>common_openaiProvider_servicetier</td><td class="arrow">â†’</td><td>common_openai_servicetier</td><td>ì„œë¹„ìŠ¤ í‹°ì–´</td></tr>
          <tr><td colspan="4" style="border:0;height:8px"></td></tr>
          <tr><td>tools_githubCopilotToken</td><td class="arrow">â†’</td><td>(ë™ì¼)</td><td>Copilot í† í°</td></tr>
        </tbody>
      </table>
      <h3 style="margin-top:16px;">ì»¤ìŠ¤í…€ í”„ë¡œë°”ì´ë” (LBI ìŠ¬ë¡¯ 1~9 â†’ CPM cpm_custom_models)</h3>
      <table class="mapping-table">
        <thead><tr><th>LBI í•„ë“œ</th><th></th><th>CPM í•„ë“œ</th><th>ë¹„ê³ </th></tr></thead>
        <tbody>
          <tr><td>displayName</td><td class="arrow">â†’</td><td>name</td><td>í‘œì‹œ ì´ë¦„</td></tr>
          <tr><td>url</td><td class="arrow">â†’</td><td>url</td><td>API URL</td></tr>
          <tr><td>apiKey</td><td class="arrow">â†’</td><td>key</td><td>API í‚¤</td></tr>
          <tr><td>model</td><td class="arrow">â†’</td><td>model</td><td>ëª¨ë¸ ID</td></tr>
          <tr><td>format (claude)</td><td class="arrow">â†’</td><td>format (anthropic)</td><td>í¬ë§· ë³€í™˜</td></tr>
          <tr><td>tokenizer</td><td class="arrow">â†’</td><td>tok</td><td>í† í¬ë‚˜ì´ì €</td></tr>
          <tr><td>hasFirstSystemPrompt</td><td class="arrow">â†’</td><td>sysfirst</td><td></td></tr>
          <tr><td>requiresAlternateRole</td><td class="arrow">â†’</td><td>altrole</td><td></td></tr>
          <tr><td>mustStartWithUserInput</td><td class="arrow">â†’</td><td>mustuser</td><td></td></tr>
          <tr><td>useMaxOutputTokensInstead</td><td class="arrow">â†’</td><td>maxout</td><td></td></tr>
          <tr><td>mergeSystemPrompt</td><td class="arrow">â†’</td><td>mergesys</td><td></td></tr>
          <tr><td>useDecoupledStreaming</td><td class="arrow">â†’</td><td>decoupled</td><td></td></tr>
          <tr><td>useThoughtSignature</td><td class="arrow">â†’</td><td>thought</td><td></td></tr>
          <tr><td>reasoningEffort</td><td class="arrow">â†’</td><td>reasoning</td><td></td></tr>
          <tr><td>verbosity</td><td class="arrow">â†’</td><td>verbosity</td><td></td></tr>
          <tr><td>thinkingLevel</td><td class="arrow">â†’</td><td>thinking</td><td>off/MINIMAL/LOW/MEDIUM/HIGH</td></tr>
          <tr><td>thinkingTokens</td><td class="arrow">â†’</td><td>(customParams)</td><td>ìˆ˜ë™ ì„¤ì • í•„ìš”</td></tr>
        </tbody>
      </table>
      <h3 style="margin-top:16px;">ì œì™¸ë˜ëŠ” LBI ì „ìš© ì„¤ì •</h3>
      <p style="color:#8b949e; font-size:0.82rem; margin-top:4px;">
        CPMì— ëŒ€ì‘í•˜ëŠ” ì„¤ì •ì´ ì—†ì–´ ì œì™¸ë©ë‹ˆë‹¤:
        chat_claude_cachingBreakpoints, chat_claude_cachingMaxExtension, chat_claude_useExperimentalCachingExtension,
        chat_claude_useSilentCachingExtension, chat_claude_useAdaptiveThinking,
        chat_gemini_removeForeignLanguage, chat_gemini_separateCot, chat_gemini_useGroundingSearch,
        chat_gemini_useStreaming, chat_gemini_useDecoupledStreaming,
        chat_removeStartANewChat, chat_autoClickTranslateButton, chat_normalizeThoughts,
        common_previewPrompt, common_useEditorForInputBox, common_disableLog, common_disableToast,
        common_gemini_blockPaidModel, common_fallbackToVertexGemini,
        compatibility_*, hypa_* (ë³„ë„ ìŠ¬ë¡¯), translation_* (ë³„ë„ ìŠ¬ë¡¯), other_* (ë³„ë„ ìŠ¬ë¡¯),
        common_deepseekProvider_reasoning, common_deepseekProvider_provider,
        common_openaiProvider_useExtendedCache, common_novelaiProvider_apiKey,
        tools_enableMCP, tools_encodeToolCall, tools_enableJsonSchema,
        usage_metrics_db, chat_sampling_* (CPMì€ RisuAI ê¸°ë³¸ ì„¤ì • ì‚¬ìš©)
      </p>
    </details>
  </div>
</div>

<script>
// ============================================================
// LBI â†’ CPM Migration Logic
// ============================================================

/**
 * LBI ì»¤ìŠ¤í…€ í”„ë¡œë°”ì´ë” ìŠ¬ë¡¯ì˜ í‚¤ ì ‘ë‘ì‚¬ë¥¼ ë°˜í™˜
 * slot 1: "common_customProvider_"
 * slot 2~9: "common_customProvider_{n}_"
 */
function lbiCustomPrefix(n) {
  return n === 1 ? 'common_customProvider_' : `common_customProvider_${n}_`;
}

/**
 * LBI format ê°’ì„ CPM format ê°’ìœ¼ë¡œ ë³€í™˜
 * LBI: openai / claude / google
 * CPM: openai / anthropic / google
 */
function convertFormat(lbiFormat) {
  if (lbiFormat === 'claude') return 'anthropic';
  return lbiFormat || 'openai';
}

/**
 * ë¬¸ìì—´ì„ booleanìœ¼ë¡œ ë³€í™˜ (LBIëŠ” ë¬¸ìì—´ë¡œ ì €ì¥)
 */
function toBool(val) {
  if (val === true || val === 'true') return true;
  return false;
}

/**
 * ê°’ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ í™•ì¸
 */
function hasValue(val) {
  return val !== undefined && val !== null && val !== '';
}

/**
 * LBI Vertex AIì˜ ê°œë³„ í•„ë“œ(projectId, privateKey, clientEmail)ë¡œë¶€í„°
 * CPMì´ ì‚¬ìš©í•˜ëŠ” JSON credential ë¬¸ìì—´ì„ í•©ì„±
 */
function buildVertexJsonFromLegacy(projectId, privateKey, clientEmail) {
  if (!projectId && !privateKey && !clientEmail) return null;
  const cred = {
    type: 'service_account',
    project_id: projectId || '',
    private_key: privateKey || '',
    client_email: clientEmail || '',
  };
  return JSON.stringify(cred, null, 2);
}

/**
 * LBIì˜ reasoning ê´€ë ¨ ê°’ì„ CPMì˜ reasoning ê°’ìœ¼ë¡œ ë³€í™˜
 * LBI reasoningEffort: '' / 'none' / 'minimal' / 'low' / 'medium' / 'high'
 * CPM reasoning (custom model): 'none' / 'off' / 'low' / 'medium' / 'high'
 */
function convertReasoningEffort(val) {
  if (!val || val === '' || val === 'none') return 'none';
  if (val === 'minimal') return 'low'; // CPMì— minimalì´ ì—†ìœ¼ë¯€ë¡œ lowë¡œ ë§¤í•‘
  return val; // low, medium, highëŠ” ë™ì¼
}

/**
 * LBI thinkingLevel ê°’ì„ CPM thinking ê°’ìœ¼ë¡œ ë³€í™˜
 * LBI: '' / 'MINIMAL' / 'LOW' / 'MEDIUM' / 'HIGH'
 * CPM: 'off' / 'none' / 'MINIMAL' / 'LOW' / 'MEDIUM' / 'HIGH'
 */
function convertThinkingLevel(val) {
  if (!val || val === '') return 'none';
  return val; // MINIMAL, LOW, MEDIUM, HIGH ê·¸ëŒ€ë¡œ
}

// ============================================================
// Main Conversion
// ============================================================

function doConvert() {
  const logEl = document.getElementById('logArea');
  const statsEl = document.getElementById('statsArea');
  const outputEl = document.getElementById('outputJson');
  logEl.style.display = 'block';
  statsEl.style.display = 'flex';
  logEl.innerHTML = '';
  statsEl.innerHTML = '';
  outputEl.value = '';

  const logs = [];
  const log = (cls, msg) => logs.push(`<span class="${cls}">${msg}</span>`);

  // ì…ë ¥ íŒŒì‹±
  let rawInput;
  try {
    rawInput = JSON.parse(document.getElementById('inputJson').value.trim());
  } catch (e) {
    log('error', `âŒ JSON íŒŒì‹± ì‹¤íŒ¨: ${e.message}`);
    logEl.innerHTML = logs.join('\n');
    return;
  }

  // LBI ì„¤ì • ì¶”ì¶œ (ë˜í•‘ í˜•íƒœ ë˜ëŠ” í”Œë« í˜•íƒœ ëª¨ë‘ ì§€ì›)
  let lbi;
  if (rawInput.lbiSettings && typeof rawInput.lbiSettings === 'object') {
    lbi = rawInput.lbiSettings;
    log('info', 'â„¹ï¸ "lbiSettings" ë˜í¼ ê°ì§€ â†’ ë‚´ë¶€ ë°ì´í„° ì‚¬ìš©');
  } else {
    lbi = rawInput;
    log('info', 'â„¹ï¸ í”Œë« JSON í˜•ì‹ìœ¼ë¡œ ì²˜ë¦¬');
  }

  const cpm = {};
  let converted = 0;
  let skipped = 0;
  let customCount = 0;

  // === Helper ===
  function migrate(lbiKey, cpmKey, label) {
    const val = lbi[lbiKey];
    if (hasValue(val)) {
      cpm[cpmKey] = String(val);
      converted++;
      log('success', `âœ… ${label}: ${lbiKey} â†’ ${cpmKey}`);
    } else {
      skipped++;
      log('skip', `  â­ ${label}: ${lbiKey} (ê°’ ì—†ìŒ)`);
    }
  }

  // ============================
  // 1. Google AI (Gemini Studio)
  // ============================
  log('info', '\nâ”€â”€ Google AI (Gemini Studio) â”€â”€');
  migrate('common_googleAIProvider_apiKey', 'cpm_gemini_key', 'Gemini API í‚¤');
  migrate('chat_gemini_thinkingLevel', 'cpm_gemini_thinking_level', 'Gemini ì‚¬ê³  ìˆ˜ì¤€');
  migrate('chat_sampling_thinkingTokens', 'cpm_gemini_thinking_budget', 'Gemini ì‚¬ê³  ì˜ˆì‚°');
  // ê³µìœ  í‚¤ (LBIì™€ CPMì—ì„œ ë™ì¼í•œ í‚¤ ì‚¬ìš©)
  migrate('chat_gemini_preserveSystem', 'chat_gemini_preserveSystem', 'ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ë³´ì¡´');
  migrate('chat_gemini_showThoughtsToken', 'chat_gemini_showThoughtsToken', 'ìƒê° í† í° í‘œì‹œ');
  migrate('chat_gemini_useThoughtSignature', 'chat_gemini_useThoughtSignature', 'ìƒê° ì„œëª… ì‚¬ìš©');
  migrate('chat_gemini_usePlainFetch', 'chat_gemini_usePlainFetch', 'ì§ì ‘ ìš”ì²­');
  // ë™ì  ëª¨ë¸ í™œì„±í™” (í‚¤ê°€ ìˆìœ¼ë©´ ì¼œê¸°)
  if (hasValue(lbi['common_googleAIProvider_apiKey'])) {
    cpm['cpm_dynamic_googleai'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_googleai = true (API í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 2. Vertex AI
  // ============================
  log('info', '\nâ”€â”€ Vertex AI â”€â”€');
  // Vertex JSON í‚¤ í•©ì„±: credentials í•„ë“œ ìš°ì„ , ì—†ìœ¼ë©´ ê°œë³„ í•„ë“œì—ì„œ í•©ì„±
  const vertexCreds = lbi['common_vertexAIProvider_credentials'];
  const vertexProjectId = lbi['common_vertexAIProvider_projectId'];
  const vertexPrivateKey = lbi['common_vertexAIProvider_privateKey'];
  const vertexClientEmail = lbi['common_vertexAIProvider_clientEmail'];

  if (hasValue(vertexCreds)) {
    // credentials í•„ë“œê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    let combinedCreds = vertexCreds;
    // ê°œë³„ í•„ë“œë„ ìˆìœ¼ë©´ ì•ì— ì¶”ê°€ (LBIì˜ ë™ì‘ê³¼ ë™ì¼)
    if (hasValue(vertexProjectId) && hasValue(vertexPrivateKey) && hasValue(vertexClientEmail)) {
      const legacyJson = buildVertexJsonFromLegacy(vertexProjectId, vertexPrivateKey, vertexClientEmail);
      combinedCreds = legacyJson + ',\n' + vertexCreds;
      log('success', 'âœ… Vertex: ê°œë³„ í•„ë“œ + credentials â†’ cpm_vertex_key_json (í•©ì„±)');
    } else {
      log('success', 'âœ… Vertex: credentials â†’ cpm_vertex_key_json');
    }
    cpm['cpm_vertex_key_json'] = combinedCreds;
    converted++;
  } else if (hasValue(vertexProjectId) && hasValue(vertexPrivateKey) && hasValue(vertexClientEmail)) {
    const legacyJson = buildVertexJsonFromLegacy(vertexProjectId, vertexPrivateKey, vertexClientEmail);
    cpm['cpm_vertex_key_json'] = legacyJson;
    converted++;
    log('success', 'âœ… Vertex: ê°œë³„ í•„ë“œ(projectId/privateKey/clientEmail) â†’ cpm_vertex_key_json (í•©ì„±)');
  } else {
    skipped++;
    log('skip', '  â­ Vertex í‚¤: ê°’ ì—†ìŒ (credentialsì™€ ê°œë³„ í•„ë“œ ëª¨ë‘ ë¹„ì–´ìˆìŒ)');
  }

  migrate('common_vertexAIProvider_customLocation', 'cpm_vertex_location', 'Vertex ë¦¬ì „');
  // Vertexì—ë„ thinking ì„¤ì • ë³µì‚¬ (Gemini ì„¤ì •ì„ Vertexì—ë„ ì ìš©)
  if (hasValue(lbi['chat_gemini_thinkingLevel'])) {
    cpm['cpm_vertex_thinking_level'] = String(lbi['chat_gemini_thinkingLevel']);
    log('info', '  â„¹ï¸ cpm_vertex_thinking_level = chat_gemini_thinkingLevel (ê³µìœ )');
  }
  if (hasValue(lbi['chat_sampling_thinkingTokens'])) {
    cpm['cpm_vertex_thinking_budget'] = String(lbi['chat_sampling_thinkingTokens']);
    log('info', '  â„¹ï¸ cpm_vertex_thinking_budget = chat_sampling_thinkingTokens (ê³µìœ )');
    // Vertexì—ì„œ Claude ëª¨ë¸ ì‚¬ìš© ì‹œì˜ thinking budgetë„ ë™ì¼ ê°’ìœ¼ë¡œ ì„¤ì •
    cpm['cpm_vertex_claude_thinking_budget'] = String(lbi['chat_sampling_thinkingTokens']);
    log('info', '  â„¹ï¸ cpm_vertex_claude_thinking_budget = chat_sampling_thinkingTokens (ê³µìœ )');
  }
  // Vertex ê³µìœ  í‚¤
  if (hasValue(lbi['chat_gemini_showThoughtsToken'])) {
    cpm['chat_vertex_showThoughtsToken'] = String(lbi['chat_gemini_showThoughtsToken']);
    log('info', '  â„¹ï¸ chat_vertex_showThoughtsToken = chat_gemini_showThoughtsToken');
  }
  if (hasValue(lbi['chat_gemini_useThoughtSignature'])) {
    cpm['chat_vertex_useThoughtSignature'] = String(lbi['chat_gemini_useThoughtSignature']);
    log('info', '  â„¹ï¸ chat_vertex_useThoughtSignature = chat_gemini_useThoughtSignature');
  }
  if (hasValue(lbi['chat_gemini_preserveSystem'])) {
    cpm['chat_vertex_preserveSystem'] = String(lbi['chat_gemini_preserveSystem']);
    log('info', '  â„¹ï¸ chat_vertex_preserveSystem = chat_gemini_preserveSystem');
  }
  // Vertex ë™ì  ëª¨ë¸
  if (hasValue(cpm['cpm_vertex_key_json'])) {
    cpm['cpm_dynamic_vertexai'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_vertexai = true (í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 3. Anthropic
  // ============================
  log('info', '\nâ”€â”€ Anthropic â”€â”€');
  migrate('common_anthropicProvider_apiKey', 'cpm_anthropic_key', 'Anthropic API í‚¤');
  migrate('chat_claude_caching', 'chat_claude_caching', 'í´ë¡œë“œ ìºì‹±');
  migrate('chat_claude_effort', 'cpm_anthropic_thinking_effort', 'í´ë¡œë“œ ë…¸ë ¥ ìˆ˜ì¤€');
  // thinking budget: chat_sampling_thinkingTokensë¥¼ Anthropicì—ë„ ì ìš©
  if (hasValue(lbi['chat_sampling_thinkingTokens'])) {
    cpm['cpm_anthropic_thinking_budget'] = String(lbi['chat_sampling_thinkingTokens']);
    log('info', '  â„¹ï¸ cpm_anthropic_thinking_budget = chat_sampling_thinkingTokens');
  }
  if (hasValue(lbi['common_anthropicProvider_apiKey'])) {
    cpm['cpm_dynamic_anthropic'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_anthropic = true (API í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 4. AWS Bedrock
  // ============================
  log('info', '\nâ”€â”€ AWS Bedrock â”€â”€');
  migrate('common_awsProvider_accessKey', 'cpm_aws_key', 'AWS ì•¡ì„¸ìŠ¤ í‚¤');
  migrate('common_awsProvider_secretAccessKey', 'cpm_aws_secret', 'AWS ì‹œí¬ë¦¿ í‚¤');
  migrate('common_awsProvider_region', 'cpm_aws_region', 'AWS ë¦¬ì „');
  // AWS thinking: chat_sampling_thinkingTokens
  if (hasValue(lbi['chat_sampling_thinkingTokens'])) {
    cpm['cpm_aws_thinking_budget'] = String(lbi['chat_sampling_thinkingTokens']);
    log('info', '  â„¹ï¸ cpm_aws_thinking_budget = chat_sampling_thinkingTokens');
  }
  if (hasValue(lbi['chat_claude_effort'])) {
    cpm['cpm_aws_thinking_effort'] = String(lbi['chat_claude_effort']);
    log('info', '  â„¹ï¸ cpm_aws_thinking_effort = chat_claude_effort');
  }
  if (hasValue(lbi['common_awsProvider_accessKey'])) {
    cpm['cpm_dynamic_aws'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_aws = true (í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 5. DeepSeek
  // ============================
  log('info', '\nâ”€â”€ DeepSeek â”€â”€');
  migrate('common_deepseekProvider_apiKey', 'cpm_deepseek_key', 'DeepSeek API í‚¤');
  migrate('common_deepseekProvider_customUrl', 'cpm_deepseek_url', 'DeepSeek ì»¤ìŠ¤í…€ URL');
  if (hasValue(lbi['common_deepseekProvider_apiKey'])) {
    cpm['cpm_dynamic_deepseek'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_deepseek = true (API í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 6. OpenAI
  // ============================
  log('info', '\nâ”€â”€ OpenAI â”€â”€');
  migrate('common_openaiProvider_apiKey', 'cpm_openai_key', 'OpenAI API í‚¤');
  migrate('common_openaiProvider_reasoningEffort', 'cpm_openai_reasoning', 'OpenAI ì¶”ë¡  ê°•ë„');
  migrate('common_openaiProvider_verbosity', 'cpm_openai_verbosity', 'OpenAI ì‘ë‹µ ìƒì„¸');
  migrate('common_openaiProvider_servicetier', 'common_openai_servicetier', 'OpenAI ì„œë¹„ìŠ¤ í‹°ì–´');
  if (hasValue(lbi['common_openaiProvider_apiKey'])) {
    cpm['cpm_dynamic_openai'] = 'true';
    log('info', '  â„¹ï¸ cpm_dynamic_openai = true (API í‚¤ ì¡´ì¬)');
  }

  // ============================
  // 7. Copilot
  // ============================
  log('info', '\nâ”€â”€ GitHub Copilot â”€â”€');
  migrate('tools_githubCopilotToken', 'tools_githubCopilotToken', 'Copilot í† í°');

  // ============================
  // 8. Custom Providers (LBI ìŠ¬ë¡¯ 1~9 â†’ CPM cpm_custom_models JSON)
  // ============================
  log('info', '\nâ”€â”€ ì»¤ìŠ¤í…€ í”„ë¡œë°”ì´ë” (ìŠ¬ë¡¯ 1~9) â”€â”€');
  const customModels = [];

  for (let n = 1; n <= 9; n++) {
    const pfx = lbiCustomPrefix(n);
    const url = lbi[pfx + 'url'];
    const model = lbi[pfx + 'model'];
    const apiKey = lbi[pfx + 'apiKey'];

    // URL ë˜ëŠ” ëª¨ë¸ì´ ìˆì–´ì•¼ ìœ íš¨í•œ ìŠ¬ë¡¯ìœ¼ë¡œ ê°„ì£¼
    if (!hasValue(url) && !hasValue(model)) {
      log('skip', `  â­ ì»¤ìŠ¤í…€ ìŠ¬ë¡¯ ${n}: ë¹„ì–´ìˆìŒ (url/model ì—†ìŒ)`);
      continue;
    }

    const lbiFormat = lbi[pfx + 'format'] || 'openai';
    const displayName = lbi[pfx + 'displayName'] || '';

    const entry = {
      uniqueId: `custom${n}`,
      name: displayName || `Custom ${n}`,
      model: model || '',
      url: url || '',
      key: apiKey || '',
      format: convertFormat(lbiFormat),
      sysfirst: toBool(lbi[pfx + 'hasFirstSystemPrompt']),
      altrole: toBool(lbi[pfx + 'requiresAlternateRole']),
      mustuser: toBool(lbi[pfx + 'mustStartWithUserInput']),
      maxout: toBool(lbi[pfx + 'useMaxOutputTokensInstead']),
      mergesys: toBool(lbi[pfx + 'mergeSystemPrompt']),
      decoupled: toBool(lbi[pfx + 'useDecoupledStreaming']),
      thought: toBool(lbi[pfx + 'useThoughtSignature']),
      reasoning: convertReasoningEffort(lbi[pfx + 'reasoningEffort']),
      verbosity: lbi[pfx + 'verbosity'] || 'none',
      thinking: convertThinkingLevel(lbi[pfx + 'thinkingLevel']),
      tok: lbi[pfx + 'tokenizer'] || 'o200k_base',
      customParams: '',
      effort: 'none',
    };

    // LBI effort(claude_effort)ê°€ ìˆìœ¼ë©´ ì»¤ìŠ¤í…€ ëª¨ë¸ effortì—ë„ ì ìš©
    // (ì»¤ìŠ¤í…€ ìŠ¬ë¡¯ì´ Anthropic í¬ë§·ì¸ ê²½ìš°)
    if (entry.format === 'anthropic' && hasValue(lbi['chat_claude_effort'])) {
      entry.effort = lbi['chat_claude_effort'];
    }

    // thinkingTokens ê°’ì´ ìˆìœ¼ë©´ ì°¸ê³  ë©”ëª¨
    const thinkingTokens = lbi[pfx + 'thinkingTokens'];
    if (hasValue(thinkingTokens) && thinkingTokens !== '0') {
      log('warn', `  âš ï¸ ì»¤ìŠ¤í…€ ìŠ¬ë¡¯ ${n}: thinkingTokens=${thinkingTokens} â†’ CPM ì»¤ìŠ¤í…€ ëª¨ë¸ì— ì§ì ‘ ëŒ€ì‘ ì—†ìŒ. í”„ë¡œë°”ì´ë”ë³„ ì„¤ì •ì—ì„œ ì¡°ì • í•„ìš”`);
    }

    customModels.push(entry);
    customCount++;
    log('success', `âœ… ì»¤ìŠ¤í…€ ìŠ¬ë¡¯ ${n}: "${entry.name}" (${entry.format}) â†’ cpm_custom_models[${customModels.length - 1}]`);
  }

  if (customModels.length > 0) {
    cpm['cpm_custom_models'] = JSON.stringify(customModels);
    converted++;
    log('success', `âœ… ì»¤ìŠ¤í…€ ëª¨ë¸ ${customModels.length}ê°œ â†’ cpm_custom_models`);
  }

  // ============================
  // ê²°ê³¼ ì¶œë ¥
  // ============================
  log('info', `\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
  log('success', `âœ… ë³€í™˜ ì™„ë£Œ: ${converted}ê°œ ì„¤ì • ë³€í™˜ë¨, ${skipped}ê°œ ê±´ë„ˆëœ€, ì»¤ìŠ¤í…€ ëª¨ë¸ ${customCount}ê°œ`);

  logEl.innerHTML = logs.join('\n');
  outputEl.value = JSON.stringify(cpm, null, 2);

  // í†µê³„
  statsEl.innerHTML = `
    <div class="stat-box"><div class="num">${converted}</div><div class="lbl">ë³€í™˜ë¨</div></div>
    <div class="stat-box"><div class="num">${skipped}</div><div class="lbl">ê±´ë„ˆëœ€</div></div>
    <div class="stat-box"><div class="num">${customCount}</div><div class="lbl">ì»¤ìŠ¤í…€ ëª¨ë¸</div></div>
    <div class="stat-box"><div class="num">${Object.keys(cpm).length}</div><div class="lbl">ì „ì²´ í‚¤ ìˆ˜</div></div>
  `;

  // ìŠ¤í¬ë¡¤
  logEl.scrollTop = logEl.scrollHeight;
}

// ============================================================
// UI ìœ í‹¸ë¦¬í‹°
// ============================================================

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    document.getElementById('inputJson').value = ev.target.result;
  };
  reader.readAsText(file, 'UTF-8');
});

function copyOutput() {
  const output = document.getElementById('outputJson');
  if (!output.value) { alert('ë³€í™˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
  navigator.clipboard.writeText(output.value).then(() => {
    alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }).catch(() => {
    output.select();
    document.execCommand('copy');
    alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  });
}

function downloadOutput() {
  const output = document.getElementById('outputJson').value;
  if (!output) { alert('ë³€í™˜ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
  const blob = new Blob([output], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const ts = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
  a.download = `cupcake_pm_settings_migrated_${ts}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function clearAll() {
  document.getElementById('inputJson').value = '';
  document.getElementById('outputJson').value = '';
  document.getElementById('logArea').style.display = 'none';
  document.getElementById('statsArea').style.display = 'none';
  document.getElementById('logArea').innerHTML = '';
  document.getElementById('statsArea').innerHTML = '';
}
</script>
</body>
</html>
